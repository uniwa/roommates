<style>
    #leftbar{
        float: left;
        margin: 0px 0px 0px 32px;
        padding: 32px;
    }
    
    #main-inner{
        float: left;
        border-left: 1px dotted #333;
        margin: 10px 0px 20px 0px;
        padding: 24px;
    }
    
    .housePic{
        float: left;
        width: 128px;
        height: 128px;
        padding: 2px;
    }
    
    #houseEdit{
        margin: 64px 0px 0px 12px;
    }
    
    .houseClear{
        clear: both;
    }
</style>

<?php
    /* fancybox: js image gallery  */
    echo $this->Html->script('jquery.fancybox-1.3.4.pack');
    echo $this->Html->script('jquery.easing-1.3.pack');
    echo $this->Html->script('jquery.mousewheel-3.0.4.pack');
    echo $this->Html->script('jQuery.fileinput');
    echo $this->Html->script('jquery.autogrowtextarea');
    echo $this->Html->script('main');
    echo $this->Html->css('fancybox/jquery.fancybox-1.3.4.css', 'stylesheet', array("media"=>"all" ), false);

    $role = $this->Session->read('Auth.User.role');

    $loggedUser = $this->Session->read('Auth.User.id');
    $houseid = $house['House']['id'];
    $userid = $house['User']['id'];
    $houseAddress = $house['House']['address'];
    $houseType = $house['HouseType']['type'];
    $housePrice = $house['House']['price'];
    $houseArea = $house['House']['area'];
    $houseFurnished = ($house['House']['furnitured'])?'επιπλωμένο':'';
    $houseMunicipality = $house['Municipality']['name'];
    $houseFree = $house['House']['free_places'];
    $houseId = $house['House']['id'];
    $houseTypeArea = $houseType.', '.$houseArea.' τ.μ.';

    $empty_slots = 4 - count($images);

    // default image
    if(isset($images[0])){
        $imageThumb = 'uploads/houses/'.$houseid.'/thumb_'.$default_image_location;
        $imageMedium = '/img/uploads/houses/'.$houseid.'/medium_'. $default_image_location;
        $imageLink = $this->Html->image($imageThumb,array('alt' => $houseTypeArea));

        $housePic = $this->Html->link($imageLink, $imageMedium,
                array('class' => 'fancyImage', 'rel' => 'group',
                'title' => $houseTypeArea, 'escape' => false));

        if($loggedUser == $houseid){
            $housePic .= "<div class='imageactions'>";
            $housePic .= $this->Html->link(__('Διαγραφή', true),
                array('controller' => 'images', 'action' => 'delete', $default_image_id),
                array('class' => 'thumb_img_delete'), sprintf(__('Είστε σίγουρος;', true)));
            $housePic .= "</div>";
        }
    }else{ // if don't have an image put placeholder
        if($loggedUser == $userid){
            // placeholder with link to add image
            $housePic = $this->Html->link($this->Html->image('addpic.png',
                array('alt' => 'add house image', 'class' => 'img-placeholder')),
                array('controller' => 'images', 'action' =>'add', $houseid),
                array('title' => 'προσθήκη εικόνας σπιτιού', 'escape' => false));
        }else{ // empty placeholder without link to add image
            $housePic = $this->Html->image('addpic.png', array(
                'alt' => 'προσθήκη εικόνας σπιτιού', 'class' => 'img-placeholder'));
        }
        $empty_slots -= 1;
    }
    
    if($loggedUser == $userid){
        //edit house
        $editHouse = $html->link('Επεξεργασία', array('action' => 'edit', $houseid));
        // delete house
        $deleteHouse = $html->link('Διαγραφή', array('action' => 'delete', $houseid),
            null, 'Είστε σίγουρος/η;');
    }
    // owner's profile (not available to real estate)
    if(($loggedUser != $userid) && ($role != 'realestate')){
        $profileid = $house['User']['Profile']['id'];
        $linkAction = "/profiles/view/{$profileid}";
        $profileLink =  $this->Html->link('Προφίλ ιδιοκτήτη', $linkAction);
    }

    // allow posts to Facebook only by a 'user' (as in role)
    if($role == 'user'){
        // create the link to post on Facebook
        $furnished = null;
        if($house['House']['furnitured']){
            $furnished = ' Επιπλωμένο, ';
        }else{
            $furnished = ', ';
        }
        // don't show 'available_places' if house does not belong to a 'user' (as in role)
        $occupation_availability = null;
        if($role != 'user'){
            $occupation_availability = '';
        }else{
            $occupation_availability = ', Διαθέσιμες θέσεις ';
            $occupation_availability .= Sanitize::html($house['House']['free_places']);
        }
        $fbUrl = "http://www.facebook.com/dialog/feed";
        $fbUrl .= "?app_id=".$facebook->getAppId();
        $fbUrl .= "&name=".urlencode('Δείτε περισσότερα εδώ...');
        $fbUrl .= "&link={$fb_app_uri}houses/view/{$houseid}";
        $fbUrl .= "&caption=".urlencode('«Συγκατοικώ»');
        $fbUrl .= "&description=".urlencode($houseTypeArea.'Ενοικίο '.$housePrice.' €,'
            .$furnished.'Δήμος '.$houseMunicipality.$occupation_availability);
        $fbUrl .= "&redirect_uri={$fb_app_uri}houses/view/{$houseid}";
        $fbLink = $this->Html->link('Κοινoποίηση στο Facebook', $fbUrl,
            array('title' => 'κοινοποίηση στο facebook'));
        $fbPost = "<div class='facebook-post'>{$fbLink}</div>";
    }
?>

<div id='leftbar'>
    <div class='housePic'>
        <?php
            echo $housePic;
        ?>
    </div>
    <div id='houseEdit'>
        <?php
            if($this->Session->read('Auth.User.id') == $userid){
                echo $editHouse.'<br />';
                echo $deleteHouse.'<br />';
            }
            if(($loggedUser != $userid) && ($role != 'realestate')){
                echo $profileLink.'<br />';
            }
            echo $fbPost.'<br />';
            
        ?>
    </div>
</div>
<div id='main-inner'>
</div>
